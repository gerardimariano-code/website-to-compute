<!DOCTYPE html>
<html>
  <head>
    <title>Memorial V5 - Audio Control</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <style>
      body { font-family: 'Georgia', serif; margin: 0; overflow: hidden; background-color: #000; }
      
      /* PANTALLA INICIO */
      #inicio-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999; 
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        color: white; transition: opacity 0.5s;
      }
      #btn-entrar {
        padding: 15px 50px; font-size: 1.2rem; margin-top: 30px;
        background: transparent; border: 2px solid #fff; color: #fff;
        cursor: pointer; border-radius: 30px; letter-spacing: 2px;
        transition: 0.3s;
      }
      #btn-entrar:hover { background: #fff; color: #000; }

      /* BOT√ìN FLOTANTE DE M√öSICA (EL SALVAVIDAS) */
      #btn-musica {
        position: fixed; bottom: 20px; left: 20px; z-index: 5000;
        background: rgba(0,0,0,0.5); border: 2px solid white; color: white;
        width: 50px; height: 50px; border-radius: 50%;
        font-size: 24px; cursor: pointer; display: none; /* Se muestra al entrar */
        align-items: center; justify-content: center;
      }
      #btn-musica:hover { background: white; color: black; }

      /* PANEL BIOGRAF√çA */
      #bio-panel {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 85%; max-width: 450px;
        background: rgba(20, 20, 20, 0.95);
        color: #ddd; padding: 30px; border-radius: 12px; border: 1px solid #555;
        display: none; z-index: 1000; text-align: center;
        box-shadow: 0 0 50px rgba(0,0,0,1);
      }
      #bio-panel.visible { display: block !important; }
      #bio-panel img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #fff; margin-bottom: 15px; }
      .cerrar-btn { padding: 8px 20px; background: #fff; color: #000; border: none; cursor: pointer; margin-top: 15px; border-radius: 5px;}
    </style>

    <script>
      // 1. CONTROL DE M√öSICA ROBUSTO
      function toggleMusica() {
        const audio = document.getElementById('musica-fondo');
        const btn = document.getElementById('btn-musica');
        
        if (audio.paused) {
          audio.play();
          btn.innerHTML = "üîä"; // Icono sonando
        } else {
          audio.pause();
          btn.innerHTML = "üîá"; // Icono silencio
        }
      }

      function entrarSitio() {
        // Ocultar inicio
        const overlay = document.getElementById('inicio-overlay');
        overlay.style.opacity = '0';
        setTimeout(() => { 
            overlay.style.display = 'none'; 
            // Mostrar el bot√≥n de m√∫sica
            document.getElementById('btn-musica').style.display = 'flex';
        }, 500);
        
        // Intentar reproducir
        const audio = document.getElementById('musica-fondo');
        audio.volume = 0.5;
        audio.play().then(() => {
            document.getElementById('btn-musica').innerHTML = "üîä";
        }).catch(e => {
            console.log("Autoplay bloqueado. El usuario deber√° usar el bot√≥n.");
            document.getElementById('btn-musica').innerHTML = "üîá";
        });
      }

      // 2. COMPONENTES AFRAME (Clic y Zoom)
      AFRAME.registerComponent('click-handler', {
        init: function () {
          this.el.addEventListener('click', function () {
            document.getElementById('bio-panel').classList.add('visible');
          });
          this.el.addEventListener('mouseenter', function () { document.body.style.cursor = 'pointer'; });
          this.el.addEventListener('mouseleave', function () { document.body.style.cursor = 'default'; });
        }
      });

      AFRAME.registerComponent('control-zoom', {
        init: function () {
          const el = this.el;
          window.addEventListener('wheel', e => el.object3D.translateZ(e.deltaY > 0 ? 1 : -1) * 0.5);
        }
      });
      
      function cerrarPanel() { document.getElementById('bio-panel').classList.remove('visible'); }
    </script>
  </head>
  <body>

    <div id="inicio-overlay">
      <h1>In Memoriam</h1>
      <button id="btn-entrar" onclick="entrarSitio()">INGRESAR</button>
    </div>

    <button id="btn-musica" onclick="toggleMusica()">üîá</button>

    <div id="bio-panel">
      <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=300&q=80">
      <h2>Juan Perez</h2>
      <p>1950 - 2023</p>
      <div style="font-style: italic; margin: 20px 0; color: #ccc;">
        "No llores ante mi tumba, no estoy all√≠..."
      </div>
      <button class="cerrar-btn" onclick="cerrarPanel()">Cerrar</button>
    </div>

    <audio id="musica-fondo" loop>
      <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
    </audio>

    <a-scene renderer="antialias: true; colorManagement: true;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
      <a-assets>
        <a-asset-item id="modelo-lapida" src="lapida.glb"></a-asset-item>
        <img id="pasto" src="pasto.jpg">
      </a-assets>

      <a-sky color="#87CEEB"></a-sky>
      <a-plane src="#pasto" position="0 0 0" rotation="-90 0 0" width="150" height="150" repeat="50 50" color="#5d6e50" material="roughness: 1; metalness: 0"></a-plane>
      
      <a-light type="directional" position="-2 4 3" intensity="1.5"></a-light>
      <a-light type="ambient" color="#FFF" intensity="0.8"></a-light>

      <a-entity position="0 0 -3">
        <a-gltf-model src="#modelo-lapida" scale="2.0 2.0 2.0"></a-gltf-model>
        <a-text value="Juan Perez" align="center" position="0 3.0 0.2" width="8" color="#FFFFFF"></a-text>
        <a-text value="1950 - 2023" align="center" position="0 2.6 0.2" width="5" color="#FFFFFF"></a-text>
        <a-text value="(Tocar para biografia)" align="center" position="0 2.2 0.2" width="3" color="#DDD"></a-text>
        
        <a-box class="clickable" click-handler position="0 2.0 0" width="3.5" height="4.5" depth="1" material="opacity: 0; transparent: true"></a-box>
      </a-entity>

      <a-entity position="0 1.8 0" camera look-controls wasd-controls control-zoom></a-entity>
    </a-scene>
  </body>
</html>
